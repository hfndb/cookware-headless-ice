{"version":3,"sources":["tags.ts"],"names":["cfg","AppConfig","getInstance","Tags","filterFlags","allowed","options","tags","styles","style","undefined","log","error","tstAllow","RegExp","join","tstIgnore","ignore","projectTags","FileUtils","readFile","dirProject","lines","split","fileTags","i","length","test","startsWith","push","forProject","dir","active","cmd","generator","async","silent","writeFile","forFile","file","includes"],"mappings":"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","sourcesContent":["import { join } from \"path\";\nimport { exec, test } from \"shelljs\";\nimport { AppConfig, FileUtils, Logger } from \"../lib\";\n\nlet cfg = AppConfig.getInstance();\n\nexport class Tags {\n\tstatic filterFlags(): string {\n\t\tlet allowed = cfg.options.tags.styles[cfg.options.tags.style];\n\t\tif (allowed == undefined)\n\t\t\tlog.error(`Style ${cfg.options.tags.style} for tags doesn't exist`);\n\t\tlet tstAllow = new RegExp(\"\\\\b(\" + allowed.join(\"|\") + \")\\\\b\", \"i\");\n\t\tlet tstIgnore = new RegExp(\n\t\t\t\"^(\" + cfg.options.tags.ignore.join(\"|\") + \")\\\\b\",\n\t\t\t\"i\"\n\t\t);\n\n\t\tlet projectTags = FileUtils.readFile(join(cfg.dirProject, \"tags\"));\n\t\tlet lines = projectTags.split(\"\\n\");\n\t\tlet fileTags = [];\n\n\t\tfor (let i = 0; i < lines.length; i++) {\n\t\t\tif (!tstAllow.test(lines[i])) continue;\n\t\t\tif (lines[i].startsWith(\"$\")) continue;\n\t\t\tif (cfg.options.tags.ignore.length > 0 && tstIgnore.test(lines[i])) continue;\n\t\t\tfileTags.push(lines[i]);\n\t\t}\n\n\t\treturn fileTags.join(\"\\n\");\n\t}\n\n\tstatic forProject(dir: string): void {\n\t\treturn;\n\t\tif (!cfg.options.tags.active) return;\n\n\t\tlet cmd = \"\";\n\n\t\tswitch (cfg.options.tags.generator) {\n\t\t\tcase \"exuberant\":\n\t\t\t\tcmd = `ctags-exuberant --fields=nksSaf --file-scope=yes --sort=no  -R ./${dir}`;\n\t\t\t\tbreak;\n\t\t\tcase \"universal\":\n\t\t\t\tcmd = `ctags-universal --fields=nksSaf --file-scope=yes  --sort=no --tag-relative=yes --totals=yes -R ./${dir} &> /dev/null`;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlog.error(`Generator ${cfg.options.tags.generator} not supported`);\n\t\t\t\treturn;\n\t\t}\n\n\t\texec(`cd ${cfg.dirProject}; ${cmd}`, { async: false, silent: true });\n\n\t\t// Create backup\n\t\tlet tags = FileUtils.readFile(join(cfg.dirProject, \"tags\"));\n\t\tFileUtils.writeFile(\n\t\t\tcfg.dirProject,\n\t\t\tjoin(\".tags\", \"tags-original\"),\n\t\t\ttags,\n\t\t\tfalse\n\t\t);\n\n\t\tFileUtils.writeFile(cfg.dirProject, \"tags\", Tags.filterFlags(), true);\n\t}\n\n\tstatic forFile(file: string): void {\n\t\tif (!cfg.options.tags.active) return;\n\n\t\tlet projectTags = FileUtils.readFile(join(cfg.dirProject, \"tags\"));\n\t\tlet lines = projectTags.split(\"\\n\");\n\t\tlet fileTags = [];\n\n\t\tfor (let i = 0; i < lines.length; i++) {\n\t\t\tif (lines[i].includes(file)) fileTags.push(lines[i]);\n\t\t}\n\n\t\tFileUtils.writeFile(\n\t\t\tcfg.dirProject,\n\t\t\tjoin(\".tags\", file),\n\t\t\tfileTags.join(\"\\n\"),\n\t\t\tfalse\n\t\t);\n\t}\n}\n"]}
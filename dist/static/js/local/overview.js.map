{"version":3,"sources":["overview.ts"],"names":["readFile","dir","file","group","report","cfg","AppConfig","getInstance","lr","LineReader","dirProject","item","Item","isInComment","line","next","parseLine","addItem","StringUtils","strip","cmtSingleLine","cmtStart","cmtEnd","ext","description","push","newComment","length","columns","ArrayUtils","endsWith","startsWith","generateStats","options","allowedExtensions","excludeList","recursive","Report","addGroup","skip","Group","files","FileUtils","getFileList","forEach","base","includes","inExcludeList","projectOverview","exclude","configuration","code","javascript","dirs","source","content","templates","styling","documentation","goodies","Object","assign","showPackages","packages"],"mappings":"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","sourcesContent":["import { basename, extname, join } from \"path\";\nimport { test } from \"shelljs\";\nimport { fileListOptions, AppConfig, FileUtils, StringUtils } from \"../lib\";\nimport { LineReader } from \"../lib/files\";\nimport { ArrayUtils } from \"../lib/object\";\nimport { getPackages } from \"../lib/package-json\";\nimport { Item, Group, Report } from \"../lib/reporting\";\n\nfunction readFile(dir: string, file: string, group: Group, report: Report) {\n\tlet cfg = AppConfig.getInstance();\n\tlet lr = new LineReader(join(cfg.dirProject, dir, file));\n\n\tlet item: Item = new Item(report, file);\n\tlet isInComment = false;\n\tdo {\n\t\tlet line = lr.next();\n\t\tif (line === false) break; // End of file\n\t\tisInComment = parseLine(line, item, isInComment);\n\t} while (true);\n\tgroup.addItem(report, item);\n}\n\nfunction parseLine(line: string, item: Item, isInComment: boolean): boolean {\n\tline = StringUtils.strip(line, true, true);\n\n\tlet cmtSingleLine: string[] = []; // Start of single line comments\n\tlet cmtStart: string[] = []; // Start of multi-line comments\n\tlet cmtEnd: string[] = []; // End of multi-line comments\n\tlet ext = extname(item.description);\n\n\tswitch (ext) {\n\t\tcase \".js\":\n\t\tcase \".ts\":\n\t\t\tcmtStart.push(\"/*\");\n\t\t\tcmtEnd.push(\"*/\");\n\t\t\tcmtSingleLine.push(\"//\");\n\t\t\tbreak;\n\t\tcase \".css\":\n\t\tcase \".scss\":\n\t\t\tcmtStart.push(\"/*\");\n\t\t\tcmtEnd.push(\"*/\");\n\t\t\tcmtSingleLine.push(\"//\");\n\t\t\tbreak;\n\t\tcase \".md\":\n\t\t\tcmtSingleLine.push(\"[comment]: <> (\");\n\t\t\tbreak;\n\t\tcase \".html\":\n\t\tcase \".njk\":\n\t\t\t// nunjucks\n\t\t\tcmtStart.push(\"{#\");\n\t\t\tcmtEnd.push(\"#}\");\n\t\t\t// html\n\t\t\tcmtStart.push(\"<!--\");\n\t\t\tcmtEnd.push(\"-->\");\n\t\t\tbreak;\n\t\tcase \".sh\":\n\t\tcase \".bat\":\n\t\t\tcmtSingleLine.push(\"#\");\n\t}\n\n\tlet newComment = false;\n\tif (line.length == 0) {\n\t\titem.columns[2]++; // empty line\n\t} else if (isInComment) {\n\t\titem.columns[1]++; // continuation comment\n\t\tif (ArrayUtils.endsWith(line, cmtEnd)) {\n\t\t\tisInComment = false;\n\t\t}\n\t} else if (ArrayUtils.startsWith(line, cmtSingleLine)) {\n\t\titem.columns[1]++;\n\t} else {\n\t\tif (ArrayUtils.startsWith(line, cmtStart)) {\n\t\t\tnewComment = isInComment = true;\n\t\t\titem.columns[1]++; // begin comment\n\t\t}\n\t\tif (!isInComment) {\n\t\t\titem.columns[0]++; // code\n\t\t}\n\t}\n\tif (newComment && ArrayUtils.endsWith(line, cmtEnd)) {\n\t\tisInComment = false;\n\t}\n\n\treturn isInComment;\n}\n\nexport function generateStats(): Report {\n\tlet cfg = AppConfig.getInstance();\n\tlet options: fileListOptions = {\n\t\tallowedExtensions: [\"\"],\n\t\texcludeList: [\"dist\", \"node_modules\"],\n\t\trecursive: true\n\t};\n\tlet report = new Report([\"File\", \"Code\", \"Comments\", \"Empty lines\"]);\n\n\tfunction addGroup(\n\t\treport: Report,\n\t\tdescription: string,\n\t\tallowedExtensions: string[],\n\t\tdir: string,\n\t\tskip: string = \"\"\n\t) {\n\t\tlet group = new Group(report, description);\n\t\toptions.allowedExtensions = allowedExtensions;\n\t\tif (!test(\"-d\", join(cfg.dirProject, dir))) return; // Directory doesn't exist\n\t\tlet files = FileUtils.getFileList(join(cfg.dirProject, dir), options);\n\t\tfiles.forEach((file: string) => {\n\t\t\tlet base = basename(file);\n\t\t\tif (skip && !base.includes(skip)) return;\n\t\t\tif (ArrayUtils.inExcludeList(cfg.options.projectOverview.exclude, file))\n\t\t\t\treturn;\n\t\t\treadFile(dir, file, group, report);\n\t\t});\n\t\treport.addGroup(group);\n\t}\n\n\tif (cfg.options.projectOverview.configuration) {\n\t\taddGroup(report, \"Configuration\", [\".json\"], \"\", \"config\");\n\t}\n\n\tif (cfg.options.projectOverview.code) {\n\t\taddGroup(\n\t\t\treport,\n\t\t\t\"Source Code\",\n\t\t\t[\".js\", \".ts\"],\n\t\t\tcfg.options.javascript.dirs.source\n\t\t);\n\t}\n\n\tif (cfg.options.projectOverview.content) {\n\t\taddGroup(report, \"Content pages\", [\".html\"], \"\");\n\t}\n\n\tif (cfg.options.projectOverview.templates) {\n\t\taddGroup(report, \"Template pages\", [\".njk\"], \"\");\n\t}\n\n\tif (cfg.options.projectOverview.styling) {\n\t\taddGroup(report, \"Styling\", [\".css\", \".scss\"], \"\");\n\t}\n\n\tif (cfg.options.projectOverview.documentation) {\n\t\taddGroup(report, \"Documentation\", [\".md\"], \"\");\n\t}\n\n\tif (cfg.options.projectOverview.goodies) {\n\t\taddGroup(report, \"Goodies\", [\".bat\", \".sh\"], \"\");\n\t}\n\n\tObject.assign(report, {\n\t\tshowPackages: cfg.options.projectOverview.showPackages\n\t});\n\tObject.assign(report, { packages: getPackages(cfg.dirProject) });\n\n\treturn report;\n}\n"]}
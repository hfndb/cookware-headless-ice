{"version":3,"sources":["create-app.ts"],"names":["process","argv","env","NODE_ENV","cfg","AppConfig","getInstance","log","Logger","options","logging","idx","Number","parseInt","bundle","javascript","apps","outDir","dirProject","dirs","output","src","source","outfile","browserify","require","dir","paths","dirMain","sep","isProject","push","node_path","length","concat","NODE_PATH","join","Module","_initPaths","external","dependencies","transform","global","plugin","pipe","encoding","info"],"mappings":"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","sourcesContent":["import { createWriteStream } from \"fs\";\nimport { join } from \"path\";\nimport { platform } from \"os\";\nimport { cd, test } from \"shelljs\";\nimport { AppConfig, Logger } from \"../lib\";\n\n// Usage: create-app.js <project dir> <index app> <for production use>\n\ncd(process.argv[2]);\nif (process.argv[4]) process.env.NODE_ENV = \"production\";\n\nlet cfg = AppConfig.getInstance(\"cookware-headless-ice\");\nlet log = Logger.getInstance(cfg.options.logging);\n\nlet idx = Number.parseInt(process.argv[3]);\nlet bundle = cfg.options.javascript.apps[idx];\nlet outDir = join(cfg.dirProject, cfg.options.javascript.dirs.output);\nlet src = join(outDir, bundle.source);\nlet outfile = join(outDir, bundle.output);\nlet browserify = require(\"browserify\");\n\n// Add some paths to NODE_PATH\nlet dir = join(cfg.dirProject, \"node_modules\");\nlet paths = [join(cfg.dirMain, \"node_modules\")];\nlet sep = platform() == \"win32\" ? \";\" : \":\";\nif (cfg.isProject && test(\"-d\", dir)) {\n\tpaths.push(cfg.dirProject);\n\tpaths.push(dir);\n}\nif (cfg.options.env.node_path && cfg.options.env.node_path.length > 0) {\n\tpaths = paths.concat(cfg.options.env.node_path);\n}\nprocess.env.NODE_PATH = paths.join(sep);\nrequire(\"module\").Module._initPaths();\n\n/*\n\tunassertify - Remove assert() calls\n\tenvify - Replace environment variablesâ€”by default, replaces NODE_ENV with \"production\"\n\tuglifyify - Remove dead code from modules\n\tcommon-shakeify - Remove unused exports from modules\n\tbrowser-pack-flat - Output a \"flat\" bundle, with all modules in a single scope\n\tbundle-collapser - When using the --no-flat option, bundle-collapser replaces file paths in require() calls with short module IDs\n */\n\nif (process.env.NODE_ENV == \"production\") {\n\t// For production use\n\tbrowserify(src)\n\t\t// https://browserify.readthedocs.io/en/latest/readme/\n\t\t// https://www.npmjs.com/package/glob\n\t\t// .exclude(file).\n\t\t// .ignore(file)\n\t\t.external(cfg.options.dependencies.browserify.external)\n\t\t.transform(\"unassertify\", { global: true })\n\t\t.transform(\"envify\", { global: true })\n\t\t.transform(\"uglifyify\", { global: true })\n\t\t.plugin(\"common-shakeify\")\n\t\t.plugin(\"browser-pack-flat/plugin\")\n\t\t.bundle()\n\t\t.pipe(\n\t\t\tcreateWriteStream(outfile, {\n\t\t\t\tencoding: \"utf8\"\n\t\t\t})\n\t\t);\n} else {\n\t// For dev purposes\n\tbrowserify(src)\n\t\t.external(cfg.options.dependencies.browserify.external)\n\t\t.bundle()\n\t\t.pipe(\n\t\t\tcreateWriteStream(outfile, {\n\t\t\t\tencoding: \"utf8\"\n\t\t\t})\n\t\t);\n}\n\nlog.info(\n\t`- written Javascript app ${bundle.output} (${\n\t\tprocess.env.NODE_ENV == \"production\" ? \"compressed\" : \"plain\"\n\t}) `\n);\n"]}
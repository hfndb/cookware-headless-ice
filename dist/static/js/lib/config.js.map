{"version":3,"sources":["config.ts"],"names":["AppConfig","constructor","name","dirHome","dirTemp","FileUtils","mkdir","dirProject","process","cwd","dirMain","__dirname","getProjectDir","env","NODE_ENV","isProject","read","dir","paths","sep","push","options","node_path","length","concat","NODE_PATH","join","require","Module","_initPaths","mergeInto","additional","readJsonFile","Object","keys","exit","version","console","warn","ObjectUtils","mergeDeep","getInstance","instance","log","Error","chdir","assign","DefaultConfig","isNew","undefined","settings","error","showConfig","diff","cfg","Logger","checkProjects","project","changes","cols","line","padEnd","toString","output","values","forEach","value","isArrayChange","path","includes","present","kind","convert","retVal","Array","isArray","JSON","stringify","String","lhs","rhs","projects","saydHello","opts","info","initNewProject","logging","on","err","isShuttingDown","error2string","newProject","dirStructure","AppMenu","alias","type","Boolean","description","getUserChoice","current","toCheck","module","commandLineArgs","chosen","showHelp","commandLineUsage","usage","addOption","opt"],"mappings":"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","sourcesContent":["import { homedir, platform, tmpdir } from \"os\";\nimport { join, normalize, sep } from \"path\";\nimport { cp } from \"shelljs\";\nimport { test } from \"shelljs\";\nimport { DefaultConfig } from \"../default-config\";\nimport { Logger } from \"./log\";\nimport { createDirTree } from \"./dirs\";\nimport { FileUtils } from \"./files\";\nimport { ObjectUtils } from \"./object\";\n\n/**\n * Configuration mechanism.\n * <br>Default settings are supposed to be in src/default-config.js\n * <br>Project setttings override and are in working directory config.json\n */\n\n/**\n * @class containing configuration settings\n * @property dirHome - Home directory of computer\n * @property dirMain - Directory of cookware-headless-ice\n * @property dirProject - Directory of current project\n * @property isProject - True if working on a project, false if on cookware-headless-ice\n * @property options - Loaded from config.json in project directory\n */\nexport class AppConfig {\n\tdirHome: string;\n\tdirMain: string;\n\tdirProject: string;\n\tdirTemp: string;\n\tisProject: boolean;\n\toptions: any;\n\tstatic instance: AppConfig | null = null;\n\n\t/**\n\t * Initializes properties based on file system, reads config.json and modifies search path\n\t * @param name of project\n\t */\n\tconstructor(name: string) {\n\t\tthis.dirHome = homedir();\n\t\tthis.dirTemp = join(tmpdir(), name); // or via package shelljs.tempdir()\n\t\tFileUtils.mkdir(this.dirTemp);\n\n\t\tthis.dirProject = normalize(process.cwd());\n\t\tthis.dirMain = normalize(__dirname);\n\t\tthis.dirMain = AppConfig.getProjectDir(this.dirMain);\n\n\t\tif (process.env.NODE_ENV == \"test\") {\n\t\t\t// Special case for testing\n\t\t\tthis.isProject = false;\n\t\t\tthis.dirProject = this.dirMain;\n\t\t} else {\n\t\t\tthis.isProject = this.dirProject != this.dirMain;\n\t\t}\n\n\t\tthis.read();\n\n\t\t// Add some paths to NODE_PATH\n\t\tlet dir = join(this.dirProject, \"node_modules\");\n\t\tlet paths = [];\n\t\tlet sep = platform() == \"win32\" ? \";\" : \":\";\n\t\tif (this.isProject && test(\"-d\", dir)) {\n\t\t\tpaths.push(dir);\n\t\t}\n\t\tpaths.push(join(this.dirMain, \"node_modules\"))\n\t\tif (this.options.env.node_path && this.options.env.node_path.length > 0) {\n\t\t\tpaths = paths.concat(this.options.env.node_path);\n\t\t}\n\t\tprocess.env.NODE_PATH = paths.join(sep);\n\t\trequire(\"module\").Module._initPaths();\n\t\t// To get the exact filename that will be loaded when require() is called, use the require.resolve() function.\n\t}\n\n\t/**\n\t * Override default settings. Object.clone() and mergeWith (loadash) don't do this properly\n\t *\n\t * @param additional path to config settings to merge into already loaded config\n\t */\n\tprivate mergeInto(additional: string): void {\n\t\tlet options: any = FileUtils.readJsonFile(additional, false);\n\t\tif (!options || Object.keys(options).length == 0) {\n\t\t\tprocess.exit(-1);\n\t\t\treturn;\n\t\t}\n\n\t\t// console.log(\"\\n\\nCurrent \", this.options);\n\t\t// console.log(\"\\n\\nAdditional \", additional, options);\n\n\t\tif (this.options.version != options.version) {\n\t\t\tconsole.warn(\n\t\t\t\t`Check and correct your project configuration and documentation about it:\\n${join(\n\t\t\t\t\tthis.dirMain,\n\t\t\t\t\t\"config.json\"\n\t\t\t\t)} \\n\\nDefault settings and project settings aren't the same version\\n`\n\t\t\t);\n\t\t}\n\n\t\tObjectUtils.mergeDeep(this.options, options);\n\t}\n\n\tstatic getProjectDir(dir: string): string {\n\t\twhile (dir.length > 2 && !test(\"-f\", join(dir, \"config.json\"))) {\n\t\t\tdir = normalize(join(dir, \"..\"));\n\t\t}\n\t\treturn dir;\n\t}\n\n\t/**\n\t * Singleton factory to get instance\n\t * @param name of project\n\t * @param dirProject set to true in case of call from project middleware.js\n\t */\n\tstatic getInstance(name: string = \"\", dirProject: string = \"\"): AppConfig {\n\t\tif (!AppConfig.instance) {\n\t\t\tif (!name) console.log(new Error(\"AppConfig initialized without project name\"));\n\n\t\t\tlet dirMain = normalize(process.cwd());\n\t\t\tif (dirProject) {\n\t\t\t\tdirProject = AppConfig.getProjectDir(dirProject);\n\t\t\t\tprocess.chdir(dirProject);\n\t\t\t}\n\n\t\t\tAppConfig.instance = new AppConfig(name);\n\n\t\t\tif (dirProject) {\n\t\t\t\tprocess.chdir(dirMain);\n\t\t\t}\n\t\t}\n\n\t\treturn AppConfig.instance;\n\t}\n\n\t/**\n\t * Read src/default-config.js and then project config.json\n\t */\n\tread(): void {\n\t\tthis.options = Object.assign({}, DefaultConfig);\n\n\t\tif (process.env.isNew != undefined) {\n\t\t\t// // Hack for new project, to prevent passing a var through the call stack\n\t\t\treturn this.options;\n\t\t}\n\n\t\tlet settings = join(this.dirProject, \"config.json\");\n\t\tif (!test(\"-f\", settings)) {\n\t\t\tconsole.error(`Project settings ${settings} not found`);\n\t\t\tprocess.exit(-1);\n\t\t}\n\t\tthis.mergeInto(settings);\n\t}\n\n\t/**\n\t* Log overridden config settings to console\n\t*/\n\tstatic showConfig(options: any = null): void {\n\t\tconst diff = require(\"deep-diff\").diff;\n\t\tlet cfg = AppConfig.getInstance();\n\t\tlet log = Logger.getInstance();\n\t\tlet checkProjects = options ? false : true;\n\n\t\tif (!options) options = Object.assign({}, DefaultConfig);\n\t\tlet project: any = FileUtils.readJsonFile(join(cfg.dirProject, \"config.json\"), false);\n\t\tlet changes = diff(options, project);\n\n\t\tlet cols = [\n\t\t\t10,\n\t\t\t50,\n\t\t\t50,\n\t\t\t50\n\t\t];\n\t\tlet line = \"\".padEnd(cols[0] + cols[1] + cols[2] + cols[3], \"-\");\n\n\t\tconsole.log(line);\n\t\tconsole.log(\"Default configuration settings:\");\n\t\tconsole.log(line);\n\t\tconsole.log(ObjectUtils.toString(options, false));\n\t\tconsole.log(\"\");\n\n\t\tconsole.log(line);\n\t\tconsole.log(\"Project configuration changes, overrides of default settings:\");\n\t\tlet output = \"Kind\".padEnd(cols[0], \" \");\n\t\toutput += \"Path\".padEnd(cols[1], \" \");\n\t\toutput += \"Application\".padEnd(cols[2], \" \");\n\t\toutput += \"Project\".padEnd(cols[3], \" \");\n\t\tconsole.log(output);\n\t\tconsole.log(line);\n\t\toutput = \"\";\n\n\t\tlet paths: string[] = [];\n\n\t\tObject.values(changes).forEach((value: any) => {\n\t\t\tlet isArrayChange = false;\n\t\t\tlet path = value.path.join(\"/\");\n\t\t\tif (paths.includes(path)) {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tpaths.push(path);\n\t\t\t}\n\t\t\tlet present = value.kind;\n\t\t\tif (present == \"D\") return;\n\t\t\tswitch (present) {\n\t\t\t\tcase \"N\":\n\t\t\t\t\tpresent = \"Added\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"A\":\n\t\t\t\t\tisArrayChange = true;\n\t\t\t\tcase \"E\":\n\t\t\t\t\tpresent = \"Edited\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\toutput += present.padEnd(cols[0], \" \");\n\t\t\toutput += path.padEnd(cols[1], \" \");\n\n\t\t\tfunction convert(value: any) {\n\t\t\t\tlet retVal = value;\n\t\t\t\tif (value == undefined) {\n\t\t\t\t\tretVal = \"\";\n\t\t\t\t} else if (typeof value == \"object\" || Array.isArray(value)) {\n\t\t\t\t\tretVal = \"\\n\" + JSON.stringify(value, null, 2);\n\t\t\t\t}\n\t\t\t\treturn String(retVal);\n\t\t\t}\n\n\t\t\tif (isArrayChange) {\n\t\t\t\t// output += convert(value.with);\n\t\t\t\toutput += \"\\n\"; // Don't show nature of change. Would distort layout\n\t\t\t} else {\n\t\t\t\toutput += convert(value.lhs).padEnd(cols[2], \" \");\n\t\t\t\toutput += convert(value.rhs).padEnd(cols[3], \" \") + \"\\n\";\n\t\t\t}\n\t\t});\n\n\t\tconsole.log(output);\n\n\t\tif (!checkProjects) return;\n\n\t\t// Check validity of config.json structure in all known projects\n\t\t// While doing that, check version number\n\t\tlet projects: string[] = cfg.options.projects;\n\t\tlet saydHello = false;\n\t\tprojects.forEach((project) => {\n\t\t\tlet opts: any = FileUtils.readJsonFile(project, true);\n\t\t\tif (opts.version != undefined && opts.version != options.version) {\n\t\t\t\tif (!saydHello) {\n\t\t\t\t\tlog.info(`Checking project config(s).Should be version ${options.version}`);\n\t\t\t\t\tsaydHello = true;\n\t\t\t\t}\n\t\t\t\tlog.warn(`- Version number ${opts.version} in ${project}`);\n\t\t\t}\n\t\t});\n\t\tif (saydHello) {\n\t\t\tlog.info(\"... done\");\n\t\t}\n\t}\n\n\t/**\n\t * Initialize new project\n\t */\n\tstatic initNewProject(): void {\n\t\tprocess.env.isNew = \"true\"; // Hack to prevent passing a var through the call stack\n\t\tlet cfg = AppConfig.getInstance(\"cookware-headless-ice\");\n\t\tlet dir = join(cfg.dirMain, \"default-project\");\n\n\t\tif (!test(\"-d\", dir)) {\n\t\t\tconsole.error(`Couldn't find directory ${dir}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log(\"Initializing new project directory\");\n\n\t\tcp(\"-fr\", join(dir, sep, \"*\"), join(cfg.dirProject, sep));\n\t\tcfg.read();\n\n\t\tlet log = Logger.getInstance(cfg.options.logging);\n\t\tprocess.on(\"uncaughtException\", (err) => {\n\t\t\tif (!log.isShuttingDown) {\n\t\t\t\tconsole.log(Logger.error2string(err));\n\t\t\t}\n\t\t});\n\t\tcreateDirTree(cfg.dirProject, cfg.options.newProject.dirStructure, true);\n\n\t\tconsole.log(\"... done\");\n\t}\n}\n\n/**\n * Function to display overridden config settings\n * @deprecated and commented away for future reference\n */\n\n/*\nexport function checkConfig() {\n\tlet cfg = AppConfig.getInstance();\n\tlet log = Logger.getInstance();\n\n\timport { addedDiff, updatedDiff } from \"deep-object-diff\";\n\n\tlet app = FileUtils.readJsonFile(join(cfg.dirMain, \"config.json\"), false);\n\tlet project = FileUtils.readJsonFile(join(cfg.dirProject, \"config.json\"), false);\n\n\t// @todo Doesn't display deep overrides like in cfg.options.dependencies.jsdoc.source.include\n\tlog.info(\"Overridden config settings:\", updatedDiff(app, project));\n\n\tlet added: object = addedDiff(app, project);\n\tif (Object.keys(added).length > 0) {\n\t\tlog.info(\"Added config settings:\", added);\n\t}\n}\n\n/**\n * For list of available options\n */\ninterface Option {\n\talias?: string;\n\tname: string;\n\ttype: any;\n\tdescription: string;\n\tmodule?: string;\n\ttypeLabel?: string;\n}\n\nexport class AppMenu {\n\tstatic instance: AppMenu | null = null;\n\n\tcheckOverridesShortcutC = {\n\t\talias: \"c\",\n\t\tname: \"config\",\n\t\ttype: Boolean,\n\t\tdescription: \"Check your project config.json; default and overridden settings\"\n\t};\n\n\tinitializeNewProjectShortcutI = {\n\t\talias: \"i\",\n\t\tname: \"init\",\n\t\ttype: Boolean,\n\t\tdescription: \"Initalize new project in current working directory\"\n\t};\n\n\tplaygroundShortcutY = {\n\t\talias: \"y\",\n\t\tname: \"playground\",\n\t\ttype: Boolean,\n\t\tdescription:\n\t\t\t\"For developement purposes: Play with functionality. Shortcut y for Y-incison during autopsy (from Greek for 'seeing with your own eyes') ðŸ˜€\"\n\t};\n\n\thelpShortcutH = {\n\t\talias: \"h\",\n\t\tname: \"help\",\n\t\ttype: Boolean,\n\t\tdescription: \"Display this usage guide.\"\n\t};\n\n\toptions: Option[] = [];\n\n\t/**\n\t * Singleton factory to get instance\n\t * @param name of project\n\t */\n\tstatic getInstance(): AppMenu {\n\t\tif (!AppMenu.instance) {\n\t\t\tAppMenu.instance = new AppMenu();\n\t\t}\n\n\t\treturn AppMenu.instance;\n\t}\n\n\tgetUserChoice(): any {\n\t\t// For programming purposes: Check for options with the same shortcut or name\n\t\tfor (let current = 0; current < this.options.length; current++) {\n\t\t\tif (process.env.NODE_ENV == \"production\") break;\n\t\t\tfor (let toCheck = 0; toCheck < this.options.length; toCheck++) {\n\t\t\t\tif (toCheck <= current) continue;\n\t\t\t\tif (this.options[toCheck].alias && this.options[current].alias == this.options[toCheck].alias) {\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t`- Double shortcut ${this.options[toCheck].alias} in modules ${this.options[current].module} and ${this.options[\n\t\t\t\t\t\t\ttoCheck\n\t\t\t\t\t\t].module}`\n\t\t\t\t\t);\n\t\t\t\t\tdelete this.options[toCheck].alias;\n\t\t\t\t}\n\t\t\t\tif (this.options[current].name == this.options[toCheck].name) {\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t`- Double name ${this.options[toCheck].name} in modules ${this.options[current].module} and ${this.options[\n\t\t\t\t\t\t\ttoCheck\n\t\t\t\t\t\t].module}`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst commandLineArgs = require(\"command-line-args\");\n\t\tlet chosen = {};\n\t\ttry {\n\t\t\tchosen = commandLineArgs(this.options);\n\t\t} catch (error) {\n\t\t\t// Do nothing\n\t\t}\n\t\treturn chosen;\n\t}\n\n\tshowHelp(opts: any) {\n\t\tconst commandLineUsage = require(\"command-line-usage\");\n\t\tconst usage = commandLineUsage(opts);\n\t\tconsole.log(usage);\n\t}\n\n\taddOption(opt: Option) {\n\t\tif (!opt.module) opt.module = \"main\";\n\t\tthis.options.push(opt);\n\t}\n}\n"]}
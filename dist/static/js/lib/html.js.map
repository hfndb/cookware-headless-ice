{"version":3,"sources":["html.ts"],"names":["Stripper","process","content","cfg","AppConfig","getInstance","options","html","stripper","active","tmp","split","len","length","retVal","i","empty","StringUtils","strip","parseLine","line","begin","end","Content","getOutputDir","log","Logger","outputDir","dirProject","dirs","output","error","writeOutput","entry","data","verbose","saydHello","info","FileUtils","writeFile","targetDir","target","getCustomContext","dir","url","file","javascript","mw","require","getAdditionalContext","execHook","type","resolved","resolve","main","renderAll","nj","caching","engine","NunjucksUtils","processed","rendered","changeList","sourcePath","targetPath","sourceExt","targetExt","excludeList","exclude","maxHtml","forEach","Math","max","targetLastModified","push","source","isNewOrModified","isChanged","lastModified","status","render","removeObsolete","opts","frmtr","Formatter","useProjectTemplates","templateDir","templates","dirMain","levelNum","occurrences","levelStr","context","description","domain","createdDate","date","Date","createdDateTime","datetime","createdTime","time","environment","env","NODE_ENV","frmt","level","path","additionalContext","Object","assign","renderFile"],"mappings":"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","sourcesContent":["import { join } from \"path\";\nimport { removeObsolete } from \"./files\";\nimport { Formatter, StringUtils } from \"./utils\";\nimport { test, touch } from \"shelljs\";\nimport {\n\tgetChangeList,\n\tAppConfig,\n\tFileStatus,\n\tFileUtils,\n\tLogger\n} from \"../lib\";\nimport { NunjucksUtils } from \"./nunjucks\";\n\n/**\n * Striptease class, to strip HTML and tease those who want to read the code\n */\nclass Stripper {\n\tstatic process(content: string): string {\n\t\tlet cfg = AppConfig.getInstance();\n\t\tif (!cfg.options.html.stripper.active) return content;\n\n\t\tlet tmp = content.split(\"\\n\");\n\t\tlet len = tmp.length;\n\t\tlet retVal = \"\";\n\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tif (\n\t\t\t\tcfg.options.html.stripper.empty &&\n\t\t\t\tStringUtils.strip(tmp[i], true, true).length == 0\n\t\t\t)\n\t\t\t\tcontinue;\n\t\t\tretVal += Stripper.parseLine(tmp[i]);\n\t\t}\n\n\t\treturn retVal;\n\t}\n\n\tstatic parseLine(line: string): string {\n\t\tlet cfg = AppConfig.getInstance();\n\t\tif (cfg.options.html.stripper.begin || cfg.options.html.stripper.end) {\n\t\t\tline = StringUtils.strip(\n\t\t\t\tline,\n\t\t\t\tcfg.options.html.stripper.begin,\n\t\t\t\tcfg.options.html.stripper.end\n\t\t\t);\n\t\t}\n\n\t\treturn line;\n\t}\n}\n\n/**\n * For render()\n */\nexport interface RenderOptions {\n\tadditionalContext?: object;\n\ttemplateDir?: string; // In case of an exotic location\n\tuseProjectTemplates?: boolean;\n}\n\nexport class Content {\n\trendered: string[] = [];\n\tsaydHello = false;\n\n\t/**\n\t * Get HTML output directory\n\t */\n\tstatic getOutputDir(): string {\n\t\tlet cfg = AppConfig.getInstance();\n\t\tlet log = Logger.getInstance();\n\t\tlet outputDir = \"\";\n\t\tif (test(\"-d\", join(cfg.dirProject, cfg.options.html.dirs.output))) {\n\t\t\t// In case of local project\n\t\t\toutputDir = join(cfg.dirProject, cfg.options.html.dirs.output);\n\t\t} else if (test(\"-d\", cfg.options.html.dirs.output)) {\n\t\t\t// In case of hosting\n\t\t\toutputDir = cfg.options.html.dirs.output;\n\t\t} else {\n\t\t\tlog.error(\"HTML output directory couldn't be determined\");\n\t\t}\n\n\t\treturn outputDir;\n\t}\n\n\tprivate writeOutput(\n\t\tentry: FileStatus,\n\t\tdata: string,\n\t\tverbose: boolean = true\n\t): void {\n\t\tif (data) {\n\t\t\tlet log = Logger.getInstance();\n\t\t\tif (!this.saydHello && verbose) {\n\t\t\t\tthis.saydHello = true;\n\t\t\t\tlog.info(\"Rendering HTML content\");\n\t\t\t}\n\t\t\tFileUtils.writeFile(entry.targetDir, entry.target, data, true);\n\t\t}\n\t}\n\n\tprivate getCustomContext(dir: string, url: string): Object {\n\t\tlet cfg = AppConfig.getInstance();\n\t\tlet file = join(\n\t\t\tcfg.dirProject,\n\t\t\tcfg.options.javascript.dirs.output,\n\t\t\t\"local\",\n\t\t\t\"data-provider.js\"\n\t\t);\n\t\tif (!test(\"-f\", file)) return {};\n\n\t\tconst mw = require(file); // Dynamically load\n\t\treturn mw.getAdditionalContext(dir, url, cfg);\n\t}\n\n\tprivate execHook(type: number): void {\n\t\tlet cfg = AppConfig.getInstance();\n\t\tlet dir = join(cfg.dirProject, cfg.options.javascript.dirs.output, \"local\");\n\t\tlet file = \"\";\n\n\t\tswitch (type) {\n\t\t\tcase 1:\n\t\t\t\tfile = \"render-before.js\";\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\t\t\t\tfile = \"render-after.js\";\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\treturn;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (!test(\"-f\", join(dir, file))) return;\n\n\t\tconst resolved = require.resolve(join(dir, file));\n\t\tconst mw = require(resolved); // Dynamically load\n\t\treturn mw.main(cfg);\n\t}\n\n\t/**\n\t * Render all changed or new HTML content files\n\t */\n\trenderAll(verbose: boolean = true): void {\n\t\tlet cfg = AppConfig.getInstance();\n\t\tlet log = Logger.getInstance();\n\t\tlet nj: NunjucksUtils;\n\t\tif (cfg.options.html.caching.engine == \"nunjucks\") {\n\t\t\tnj = new NunjucksUtils();\n\t\t} else {\n\t\t\tlog.error(`Unkown template engine ${cfg.options.html.caching.engine}`);\n\t\t}\n\n\t\t// Determine outputdir\n\t\tlet outputDir = Content.getOutputDir();\n\n\t\tlet processed: string[] = [];\n\t\tthis.rendered = [];\n\n\t\tlet changeList = getChangeList({\n\t\t\tsourcePath: join(cfg.dirProject, cfg.options.html.dirs.content),\n\t\t\ttargetPath: outputDir,\n\t\t\tsourceExt: [\".html\", \".njk\"],\n\t\t\ttargetExt: \".html\",\n\t\t\texcludeList: cfg.options.html.caching.exclude\n\t\t});\n\n\t\tthis.execHook(1); // Hook render-before\n\n\t\tif (changeList.length > 0) {\n\t\t\tlet content: string;\n\t\t\tlet maxHtml = 0; // to get the latest modified HTML content\n\n\t\t\tchangeList.forEach((entry: FileStatus) => {\n\t\t\t\tmaxHtml = Math.max(maxHtml, entry.targetLastModified);\n\t\t\t\tprocessed.push(entry.source);\n\t\t\t\tif (\n\t\t\t\t\t!entry.isNewOrModified() &&\n\t\t\t\t\tcfg.options.html.caching.engine == \"nunjucks\" &&\n\t\t\t\t\tnj.isChanged(entry.dir, entry.source, entry.lastModified)\n\t\t\t\t) {\n\t\t\t\t\tentry.status = \"modified\";\n\t\t\t\t\ttouch(join(entry.dir, entry.source)); // To prevent this from happening again\n\t\t\t\t}\n\n\t\t\t\tif (entry.isNewOrModified()) {\n\t\t\t\t\tcontent = this.render(entry.dir, entry.source);\n\t\t\t\t\tthis.writeOutput(entry, content, verbose);\n\t\t\t\t\tthis.rendered.push(entry.source);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.execHook(2); // Hook render-after\n\n\t\tremoveObsolete(\n\t\t\tcfg.options.html.caching.removeObsolete,\n\t\t\tprocessed,\n\t\t\toutputDir,\n\t\t\t\".html\"\n\t\t);\n\n\t\tif (this.saydHello && verbose) {\n\t\t\tlog.info(\"... HTML done\");\n\t\t} else if (verbose) {\n\t\t\tlog.info(\"No changes in HTML files found\");\n\t\t}\n\t}\n\n\t/**\n\t * Read a HTML content file file from disk and render it\n\t *\n\t * @todo implement multiple template engines\n\t */\n\trender(dir: string, file: string, opts?: RenderOptions): string {\n\t\tlet cfg = AppConfig.getInstance();\n\t\tconst frmtr = Formatter.getInstance();\n\t\tlet retVal = \"\";\n\n\t\tif (!opts) opts = {};\n\t\tif (!opts.useProjectTemplates) opts.useProjectTemplates = true;\n\n\t\tlet templateDir;\n\t\tif (opts.templateDir) {\n\t\t\ttemplateDir = opts.templateDir;\n\t\t} else if (opts.useProjectTemplates) {\n\t\t\ttemplateDir = join(cfg.dirProject, cfg.options.html.dirs.templates[0]);\n\t\t} else {\n\t\t\ttemplateDir = join(cfg.dirMain, \"templates\");\n\t\t}\n\n\t\t// Determine prefix for statics, variable 'level' in context and base template\n\t\tlet levelNum = StringUtils.occurrences(file, \"/\");\n\t\tlet levelStr = \"\";\n\t\tfor (let i = 1; i < levelNum; i++) {\n\t\t\tlevelStr = levelStr + \"../\";\n\t\t}\n\n\t\t/**\n\t\t * <p>\n\t\t *   By default in context:\n\t\t * </p>\n\t\t * <ul>\n\t\t *   <li>frmt - instance of Formatter in lib/utils.js</li>\n\t\t *   <li>path and reqUrl - relative to root</li>\n\t\t *   <li>level - relative to root</li>\n\t\t *   <li>description - of website</li>\n\t\t *   <li>url - Home URL of website</li>\n\t\t *   <li>createdDate - formatted string</li>\n\t\t *   <li>createdDateTime - formatted string</li>\n\t\t *   <li>createdTime - formatted string</li>\n\t\t *   <li>environment - Node.js environment</li>\n\t\t * </ul>\n\t\t */\n\t\tlet context = {\n\t\t\tdescription: cfg.options.domain.description,\n\t\t\tcreatedDate: frmtr.date(new Date()),\n\t\t\tcreatedDateTime: frmtr.datetime(new Date()),\n\t\t\tcreatedTime: frmtr.time(new Date()),\n\t\t\tenvironment: process.env.NODE_ENV,\n\t\t\tfrmt: frmtr,\n\t\t\tlevel: levelStr,\n\t\t\tpath: file,\n\t\t\turl: cfg.options.domain.url\n\t\t};\n\t\tif (opts.additionalContext) {\n\t\t\tObject.assign(context, opts.additionalContext);\n\t\t}\n\t\tObject.assign(context, this.getCustomContext(dir, file));\n\n\t\tswitch (cfg.options.html.caching.engine) {\n\t\t\tcase \"nunjucks\":\n\t\t\t\tretVal = NunjucksUtils.renderFile(dir, file, context, templateDir);\n\t\t}\n\n\t\tretVal = Stripper.process(retVal);\n\n\t\treturn retVal;\n\t}\n}\n"]}
{"version":3,"sources":["index.ts"],"names":["am","AppMenu","getInstance","addOption","alias","name","type","String","description","typeLabel","checkOverridesShortcutC","Boolean","initializeNewProjectShortcutI","playgroundShortcutY","helpShortcutH","choice","getUserChoice","init","AppConfig","initNewProject","cfg","log","Logger","options","logging","process","chdir","dirMain","on","err","isShuttingDown","console","error2string","stats","beautify","docs","javascript","compiler","config","showConfig","epub","generate","lint","Lint","content","pdf","run","touch","allow","dir","html","dirs","push","sass","source","error","FileUtils","touchRecursive","dirProject","allowedExtensions","playground","showHelp","header","hide","optionList","session","SessionVars","info","toString"],"mappings":"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","sourcesContent":["import { join } from \"path\";\nimport { Lint } from \"./local/markup\";\nimport { renderEpub } from \"./local/epub\";\nimport { FileUtils, Logger } from \"./lib\";\nimport { AppConfig, AppMenu } from \"./lib/config\";\nimport { generateJsDocs } from \"./local/javascript\";\nimport { beautify, generateWeb } from \"./local/misc\";\nimport { renderPdf } from \"./local/pdf\";\nimport { generateTsDocs } from \"./local/typescript\";\nimport { playGround } from \"./dev/playground\";\nimport { coatRack } from \"./server/index\";\nimport { SessionVars } from \"./sys/session\";\n\nlet am = AppMenu.getInstance();\n\n/**\n * Note for software architects and developers:\n *\n * Please read about project philosophy and related ethics in the docs, page \"Design goals and roadmap\".\n */\n\n// Define menu options\nam.addOption({\n\talias: \"b\",\n\tname: \"beautify\",\n\ttype: String,\n\tdescription: \"Beautifies html, js, ts or scss file - or all such files in directory\",\n\ttypeLabel: \"<path>\"\n});\nam.addOption(am.checkOverridesShortcutC);\nam.addOption({\n\talias: \"d\",\n\tname: \"docs\",\n\ttype: Boolean,\n\tdescription: \"Generate API docs for (JavaScript or TypeScript) source files\"\n});\nam.addOption({\n\talias: \"e\",\n\tname: \"epub\",\n\ttype: Boolean,\n\tdescription: \"Convert changed html files to signed ePub\"\n});\nam.addOption({\n\talias: \"g\",\n\tname: \"generate\",\n\ttype: Boolean,\n\tdescription:\n\t\t\"Transcompile changed js, ts and scss, render changed .html using template engine, \\\n\t\t\tgenerate Google sitemap.\"\n});\nam.addOption(am.initializeNewProjectShortcutI);\nam.addOption({\n\talias: \"l\",\n\tname: \"lint\",\n\ttype: Boolean,\n\tdescription: \"Lint html\"\n});\nam.addOption({\n\talias: \"p\",\n\tname: \"pdf\",\n\ttype: Boolean,\n\tdescription: \"Generate pdf's based on changed html\"\n});\nam.addOption({\n\talias: \"r\",\n\tname: \"run\",\n\ttype: Boolean,\n\tdescription: \"Run local development server\"\n});\nam.addOption({\n\talias: \"t\",\n\tname: \"touch\",\n\ttype: String,\n\tdescription: \"Touch files recursively, in order to force regeneration of output. Valid types: content, sass, src\",\n\ttypeLabel: \"<type>\"\n});\nam.addOption(am.playgroundShortcutY);\nam.addOption(am.helpShortcutH);\n\nlet choice = am.getUserChoice();\n\nif (choice.init) {\n\tAppConfig.initNewProject();\n} else {\n\tlet cfg = AppConfig.getInstance(\"cookware-headless-ice\");\n\tlet log = Logger.getInstance(cfg.options.logging);\n\tprocess.chdir(cfg.dirMain); // Always work from application directory\n\tprocess.on(\"uncaughtException\", (err) => {\n\t\tif (!log.isShuttingDown) {\n\t\t\tconsole.log(Logger.error2string(err));\n\t\t}\n\t});\n\n\tlet stats = false;\n\tif (choice.beautify) {\n\t\tbeautify(choice.beautify);\n\t} else if (choice.docs && cfg.options.javascript.compiler == \"typescript\") {\n\t\tgenerateTsDocs();\n\t} else if (choice.docs) {\n\t\tgenerateJsDocs();\n\t} else if (choice.config) {\n\t\tAppConfig.showConfig();\n\t} else if (choice.epub) {\n\t\trenderEpub();\n\t} else if (choice.generate) {\n\t\tgenerateWeb(true);\n\t\tstats = true;\n\t} else if (choice.lint) {\n\t\tLint.content();\n\t} else if (choice.pdf) {\n\t\trenderPdf();\n\t} else if (choice.run) {\n\t\tcoatRack();\n\t} else if (choice.touch) {\n\t\tlet allow = [];\n\t\tlet dir = cfg.options.html.dirs.content;\n\t\tswitch (choice.touch) {\n\t\t\tcase \"content\":\n\t\t\t\tallow.push(\".html\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"sass\":\n\t\t\t\tdir = cfg.options.sass.dirs.source;\n\t\t\t\tallow.push(\".css\");\n\t\t\t\tallow.push(\".sass\");\n\t\t\t\tallow.push(\".scss\");\n\t\t\t\tbreak;\n\n\t\t\tcase \"src\":\n\t\t\t\tdir = cfg.options.javascript.dirs.source;\n\t\t\t\tallow.push(\".js\");\n\t\t\t\tallow.push(\".ts\");\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tlog.error(`Unknown type ${choice.touch}`);\n\t\t\t\tbreak;\n\t\t}\n\t\tFileUtils.touchRecursive(join(cfg.dirProject, dir), {\n\t\t\tallowedExtensions: allow\n\t\t});\n\t} else if (choice.playground) {\n\t\tplayGround();\n\t} else {\n\t\tam.showHelp([\n\t\t\t{\n\t\t\t\theader: \"cookware-headless-ice\",\n\t\t\t\tcontent: \"Utility functions\"\n\t\t\t},\n\t\t\t{\n\t\t\t\theader: \"Options\",\n\t\t\t\thide: [\n\t\t\t\t\t\"number\"\n\t\t\t\t],\n\t\t\t\toptionList: am.options\n\t\t\t},\n\t\t\t{\n\t\t\t\tcontent: \"Project home: {underline https://github.com/hfndb/cookware-headless-ice}\"\n\t\t\t}\n\t\t]);\n\t}\n\tif (stats) {\n\t\tlet session = SessionVars.getInstance();\n\t\tlog.info(session.toString());\n\t}\n}\n"]}